# Juggernaut v1.0 â€” Technical Specification

> **Date:** 2026-02-06
> **Status:** Draft for review
> **Audience:** AI agents and human developers

---

## 1. Executive Summary

### What Is Juggernaut?

A **modular, plugin-based desktop application** for managing WordPress content. It syncs WordPress posts to a local SQLite database, lets you bulk-edit them offline with a powerful table/modal interface, and pushes changes back with conflict detection. A plugin system extends support for WordPress ecosystem plugins (MetaBox, SEOPress, ACF, Yoast, WooCommerce, etc.).

### Fresh Start vs Fix?

**Recommendation: Fix the existing app.** Here's why:

#### What's Already Solid (~60-70% done)

| Layer | Lines | Quality | Notes |
|-------|-------|---------|-------|
| Plugin type system | 696 | âœ… Excellent | `types.ts` â€” comprehensive interfaces for plugins, hooks, profiles, tabs, fields, UI extensions |
| Hook system | 335 | âœ… Good | Priority-ordered event system, subscribe/trigger pattern |
| Plugin registry | 295 | âœ… Good | Enable/disable, state persistence |
| Plugin loader | 473 | âœ… Good | Dynamic loading, lifecycle management |
| WP REST client | 439 | âœ… Good | Profile-driven, dynamic post types and taxonomies |
| Sync engine | 411 | âœ… Good | Paginated fetch, taxonomy sync, profile-driven |
| Push engine | 409 | âœ… Good | Conflict detection, batch updates, dirty tracking |
| Query layer | 537 | âœ… Good | Full CRUD for resources, terms, metadata |
| Database | 484 | âœ… Good | SQLite + WAL, schema init, singleton |
| Profile manager | 389 | âœ… Good | Singleton, auto-load, taxonomy/post-type accessors |
| Electron main | 378 | âœ… Good | Keychain creds, auto-updates, utilityProcess |
| Bundled plugins | ~600 | âœ… Good | MetaBox + SEOPress with manifests and hook integration |
| **Subtotal** | **~5,446** | | **All reusable as-is or with minor fixes** |

#### What's Broken/Tangled

| Component | Lines | Problem |
|-----------|-------|---------|
| `EditModal.tsx` | 1,965 | Monolithic. PLEXKITS MetaBox fields hardcoded. Should be plugin-driven tabs. |
| `CreateModal.tsx` | 273 | Hardcoded `EDITABLE_TAXONOMIES` array |
| `ResourceTable.tsx` | 366 | Hardcoded `plexkits.com` links, `resource-type` column |
| `settings/page.tsx` | 1,121 | Monolithic. Should be broken into sub-components. |
| `site-config.ts` | 98 | Hardcoded PLEXKITS site URLs as const array |
| `utils.ts` | 122 | Hardcoded `TAXONOMY_LABELS` fallback |
| `better-sqlite3` | â€” | Native module compiled for Electron ABI, breaks `npm run dev` |
| **Subtotal** | **~3,945** | **Needs rewriting/refactoring** |

#### Why Not Start Fresh?

Starting fresh means rewriting **~9,500 lines** and losing 2-3 weeks to get back to the current state. The target architecture is essentially what's already partially built. The plugin type system alone (696 lines of carefully designed interfaces) would take significant effort to recreate.

The broken parts are concentrated in the **UI layer** â€” specifically 3 component files and 2 config files. The fix path is clear: make UI components consume the plugin/profile system that already exists but isn't wired up to the frontend.

---

## 2. Architecture

### Layer Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ELECTRON SHELL                          â”‚
â”‚  main.ts â”‚ preload.ts â”‚ safeStorage â”‚ auto-updater              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         UI LAYER                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Core Tabs  â”‚ â”‚ Plugin Tabs  â”‚ â”‚ Plugin Tabs  â”‚  â† dynamic   â”‚
â”‚  â”‚ (Basic,    â”‚ â”‚ (provided by â”‚ â”‚ (provided by â”‚              â”‚
â”‚  â”‚  Classify, â”‚ â”‚  MetaBox)    â”‚ â”‚  SEOPress)   â”‚              â”‚
â”‚  â”‚  AI Fill)  â”‚ â”‚              â”‚ â”‚              â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  ResourceTable â”‚ EditModal â”‚ FilterPanel â”‚ Settings             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       API ROUTES                                â”‚
â”‚  /sync â”‚ /push â”‚ /resources â”‚ /terms â”‚ /profile â”‚ /plugins      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      PLUGIN SYSTEM                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Registry â”‚ â”‚ Loader   â”‚ â”‚ Hooks    â”‚ â”‚ Types    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      CORE SERVICES                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ WP Client  â”‚ â”‚ Sync Engineâ”‚ â”‚ Push Engineâ”‚ â”‚ DB Layer   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     PROFILE SYSTEM                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Manager      â”‚ â”‚ Import/Exportâ”‚ â”‚ Site Config  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Principle: The Core Knows Nothing About Specific WordPress Plugins

The core app handles: posts, pages, custom post types, taxonomies, basic fields (title, content, excerpt, featured image, status, slug), local SQLite caching, dirty-state tracking, push/pull sync.

**Everything else comes from plugins.** MetaBox fields, SEOPress SEO data, ACF groups, WooCommerce products â€” all via the plugin system.

---

## 3. Plugin System

### 3.1 Plugin Interface

Already defined in `src/lib/plugins/types.ts`. Every plugin implements `JuggernautPlugin`:

```typescript
interface JuggernautPlugin {
  // Metadata
  id: string;
  name: string;
  version: string;
  manifest: PluginManifest;

  // Lifecycle
  initialize(core: CoreAPI): Promise<void>;
  activate(profile: SiteProfile, settings: Record<string, unknown>): Promise<void>;
  deactivate(): Promise<void>;

  // Data transformation (WP â†” Local)
  transformResourceForSync?(resource: WPResource): Promise<WPResource>;
  transformResourceForPush?(resource: LocalResource, payload: PushPayload): Promise<PushPayload>;

  // UI Extensions â€” THIS IS THE KEY MISSING PIECE
  getTabs?(): TabDefinition[];
  getFieldRenderers?(): Record<string, ComponentType<FieldRendererProps>>;
  getSettingsPanel?(): ComponentType<SettingsPanelProps>;
  getFilterComponents?(): ComponentType<FilterComponentProps>[];

  // WordPress detection
  detectWordPressPlugin?(baseUrl: string, authHeader: string): Promise<boolean>;
}
```

### 3.2 What's Implemented vs What's Missing

| Capability | Interface Defined | Backend Implemented | Frontend Wired Up |
|------------|:-:|:-:|:-:|
| Plugin lifecycle (init/activate/deactivate) | âœ… | âœ… | N/A |
| Data transform hooks (sync/push) | âœ… | âœ… | N/A |
| `getTabs()` â€” plugin-provided UI tabs | âœ… | âŒ Not called | âŒ EditModal ignores it |
| `getFieldRenderers()` â€” generic field rendering | âœ… | âŒ Not called | âŒ Fields hardcoded |
| `getSettingsPanel()` | âœ… | âŒ Not called | âŒ |
| `getFilterComponents()` | âœ… | âŒ Not called | âŒ |
| WordPress plugin detection | âœ… | âœ… MetaBox only | âŒ No first-launch wiring |

**The type system is there. The backend hooks work. The frontend doesn't use any of the UI extension points.** This is the core gap.

### 3.3 Plugin Tiers

| Tier | Badge | Description | Current Status |
|------|-------|-------------|----------------|
| **BUNDLED** | ğŸŸ¢ | Ships with app | MetaBox âœ…, SEOPress âœ… |
| **OFFICIAL** | ğŸ”µ | Free, maintained by us | ACF âŒ, Yoast âŒ, WooCommerce âŒ |
| **COMMUNITY** | ğŸŸ¡ | PR-submitted | No infrastructure yet |
| **PREMIUM** | ğŸŸ£ | Paid, marketplace | Future (v1.1+) |

### 3.4 Bundled Plugin Structure

```
src/lib/plugins/bundled/
  metabox/
    manifest.json       # Plugin metadata
    index.ts            # Plugin class implementing JuggernautPlugin
    components/         # â† MISSING: should contain MetaBoxTab.tsx, field renderers
  seopress/
    manifest.json
    index.ts
    components/         # â† MISSING: should contain SEOTab.tsx
```

**What needs to happen:** Each bundled plugin should provide its own React components via `getTabs()` and `getFieldRenderers()`. The EditModal should render whatever tabs the active plugins provide, not hardcode PLEXKITS-specific MetaBox fields.

---

## 4. Profile System

### 4.1 Profile Schema

Already defined in `types.ts` as `SiteProfile`. A profile is a JSON file that configures everything about a WordPress site:

```json
{
  "profile_id": "plexkits",
  "profile_name": "PLEXKITS Resources",
  "profile_version": "1.0.0",

  "sites": [
    { "id": "local", "name": "Local Dev", "url": "http://plexkits-v4.local" },
    { "id": "production", "name": "Production", "url": "https://plexkits.com", "is_default": true }
  ],

  "post_types": [
    {
      "slug": "resource",
      "name": "Resource",
      "rest_base": "resource",
      "is_primary": true,
      "supports": ["title", "editor", "thumbnail", "excerpt"]
    }
  ],

  "taxonomies": [
    {
      "slug": "resource-type",
      "name": "Resource Type",
      "rest_base": "resource-type",
      "post_types": ["resource"],
      "show_in_filter": true,
      "editable": true
    }
  ],

  "required_plugins": [
    { "id": "metabox", "auto_enable": true },
    { "id": "seopress", "auto_enable": true }
  ],

  "plugin_settings": {
    "metabox": {
      "taxonomy_meta_mapping": {
        "resource-type": "tax_resource_type",
        "topic": "tax_topic"
      },
      "field_mapping": {
        "intro_text": { "type": "textarea", "label": "Intro Text", "tab": "content" },
        "group_features": { "type": "repeater", "label": "Features", "tab": "features" },
        "download_sections": { "type": "group", "label": "Downloads", "tab": "downloads" }
      }
    }
  },

  "ui": {
    "tabs": [
      { "id": "basic", "label": "Basic", "source": "core" },
      { "id": "content", "label": "Content", "source": "metabox" },
      { "id": "features", "label": "Features", "source": "metabox" },
      { "id": "classification", "label": "Classification", "source": "core" },
      { "id": "downloads", "label": "Downloads", "source": "metabox" },
      { "id": "seo", "label": "SEO", "source": "seopress" },
      { "id": "ai", "label": "AI Fill", "source": "core" }
    ],
    "branding": {
      "app_name": "PLEXKITS Manager",
      "primary_color": "#6366f1"
    },
    "features": {
      "ai_fill": true,
      "prompt_templates": true,
      "bulk_edit": true
    }
  }
}
```

### 4.2 Profile System Status

| Feature | Status |
|---------|--------|
| Profile schema (TypeScript types) | âœ… Complete |
| ProfileManager singleton | âœ… Complete |
| Auto-load default profile | âœ… Complete |
| Bundled `plexkits.json` profile | âœ… Complete |
| Profile import from file | âŒ Throws "not implemented" |
| Profile export | âŒ Not implemented |
| Profile creation wizard | âŒ Not implemented |
| Site targets from profile | âŒ Hardcoded in `site-config.ts` |
| Auto-enable required plugins | âŒ Not wired |

### 4.3 What Needs to Happen

1. `site-config.ts` should read site targets from the active profile's `sites` array, not from a hardcoded const
2. `ProfileManager.loadProfileFromFile()` must be implemented
3. When a profile is imported, its `required_plugins` should auto-enable matching plugins
4. A "starter" profile should ship for basic WordPress (posts + categories + tags, no plugins)

---

## 5. UI Architecture

### 5.1 Current State

The UI is 5 components totaling ~4,700 lines:

| Component | Lines | Problem |
|-----------|-------|---------|
| `EditModal.tsx` | 1,965 | Contains ALL MetaBox field rendering (features, downloads, changelog, content tabs), hardcoded taxonomy patterns for AI fill, hardcoded `plexkits.com` links. Should be ~300 lines of generic shell + plugin-provided tab components. |
| `settings/page.tsx` | 1,121 | Four tabs in one file. Should be split into `TargetTab`, `PromptsTab`, `PluginsTab`, `DiagnosticsTab`. |
| `page.tsx` (main) | 676 | Dashboard page. Reasonably structured. |
| `ResourceTable.tsx` | 366 | Hardcoded `plexkits.com` links and `resource-type` column. Should use profile data. |
| `CreateModal.tsx` | 273 | Hardcoded `EDITABLE_TAXONOMIES`. Should read from profile. |

### 5.2 Target Architecture

#### EditModal (Generic Shell)

```
EditModal (generic, ~300 lines)
â”œâ”€â”€ Tab Bar (reads tabs from profile.ui.tabs + plugin.getTabs())
â”œâ”€â”€ Core Tabs (built-in)
â”‚   â”œâ”€â”€ BasicTab (title, slug, status, featured image)
â”‚   â”œâ”€â”€ ClassificationTab (taxonomies from profile, rendered generically)
â”‚   â””â”€â”€ AIFillTab (uses prompt templates + profile taxonomy slugs)
â””â”€â”€ Plugin Tabs (injected by plugins)
    â”œâ”€â”€ MetaBox Content Tab (rendered by metabox plugin)
    â”œâ”€â”€ MetaBox Features Tab (rendered by metabox plugin)
    â”œâ”€â”€ MetaBox Downloads Tab (rendered by metabox plugin)
    â””â”€â”€ SEO Tab (rendered by seopress plugin)
```

Each plugin provides its tab components via `getTabs()`:

```typescript
// In metabox plugin
getTabs(): TabDefinition[] {
  return [
    { id: 'content', label: 'Content', component: MetaBoxContentTab, position: 2 },
    { id: 'features', label: 'Features', component: MetaBoxFeaturesTab, position: 4 },
    { id: 'downloads', label: 'Downloads', component: MetaBoxDownloadsTab, position: 6 },
  ];
}
```

#### ResourceTable (Profile-Driven)

- "View on site" links use `getActiveBaseUrl()` + `postType.rest_base` from profile
- Taxonomy columns come from `profile.taxonomies.filter(t => t.show_in_filter)`
- No hardcoded slugs anywhere

#### CreateModal (Profile-Driven)

- Editable taxonomies come from `profile.taxonomies.filter(t => t.editable)`
- No hardcoded `EDITABLE_TAXONOMIES` array

---

## 6. Core Services

### 6.1 WordPress Client (`wp-client.ts`)

**Status: âœ… Mostly generic.** One legacy fallback to clean up:
- Line 32: `WP_BASE_URL` fallback to `https://plexkits.com` â€” should fallback to empty string

### 6.2 Sync Engine (`sync.ts`)

**Status: âœ… Generic.** Uses `getTaxonomies()` from profile. Works with any post type via `fetchAllResources()`. Supports `SyncProgressCallback` for real-time progress tracking (phases: taxonomies â†’ fetching â†’ media â†’ SEO per post type). API route streams progress via SSE.

### 6.3 Push Engine (`push.ts`)

**Status: âœ… Mostly generic.** Uses profile taxonomies. Resolves featured image URLs to WordPress media attachment IDs during push (handles resized URL variants like `-1024x778`). One issue: `TAXONOMY_META_FIELD` mapping imported from MetaBox plugin â€” should come from profile's `plugin_settings.metabox.taxonomy_meta_mapping` instead.

### 6.4 Database (`db.ts`)

**Status: âœ… Works.** Two minor fixes:
- Rename default path from `plexkits.db` to `juggernaut.db`
- Remove "PLEXKITS Resource Manager" comment

### 6.5 Queries (`queries.ts`)

**Status: âœ… Generic.** No PLEXKITS-specific code.

---

## 7. Electron Integration

### 7.1 Current Architecture

```
Electron Main Process
â”œâ”€â”€ Creates BrowserWindow (hiddenInset titlebar)
â”œâ”€â”€ Starts Next.js server via utilityProcess.fork()
â”œâ”€â”€ Handles Keychain credentials (safeStorage)
â”œâ”€â”€ Auto-update via electron-updater
â””â”€â”€ IPC handlers: get/set/delete credentials, app version, updates
```

### 7.2 Known Issue: Native Module ABI Mismatch

**Root cause:** `postinstall: "electron-builder install-app-deps"` recompiles `better-sqlite3` for Electron's Node.js (MODULE_VERSION 125), breaking `npm run dev` on system Node.js (v25.6.0 = MODULE_VERSION 141).

**Fix:** Replace `postinstall` with a dedicated rebuild step only used before Electron packaging:

```json
{
  "scripts": {
    "postinstall": "",
    "rebuild:electron": "electron-builder install-app-deps",
    "electron:build:mac": "npm run build && npm run rebuild:electron && npm run build:electron && electron-builder --mac"
  }
}
```

### 7.3 Credential Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ELECTRON MODE (Production)                                  â”‚
â”‚                                                             â”‚
â”‚  Settings UI                                                â”‚
â”‚    â””â”€â–º window.electronAPI.setCredentials()                  â”‚
â”‚          â””â”€â–º IPC â†’ main process                             â”‚
â”‚                â””â”€â–º safeStorage.encryptString() â†’ Keychain   â”‚
â”‚                â””â”€â–º Injects into process.env                 â”‚
â”‚                â””â”€â–º Restarts Next.js server                  â”‚
â”‚                                                             â”‚
â”‚  Next.js Server (utilityProcess)                            â”‚
â”‚    â””â”€â–º wp-client.ts â†’ getWpCredentials()                    â”‚
â”‚          â””â”€â–º site-config.json credentials (if set)          â”‚
â”‚          â””â”€â–º process.env fallback (from Keychain injection) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DEV MODE (Browser)                                          â”‚
â”‚                                                             â”‚
â”‚  Settings UI                                                â”‚
â”‚    â””â”€â–º fetch('/api/site-config', { credentials })           â”‚
â”‚          â””â”€â–º Saved to site-config.json (less secure)        â”‚
â”‚                                                             â”‚
â”‚  Next.js Server                                             â”‚
â”‚    â””â”€â–º wp-client.ts â†’ getWpCredentials()                    â”‚
â”‚          â””â”€â–º site-config.json credentials                   â”‚
â”‚          â””â”€â–º .env.local fallback                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **Status**: No first-launch wizard exists yet. Users currently go to Settings â†’ Target Site to enter credentials manually.

---

## 8. Implementation Plan

### Phase A: Unblock Development (Day 1)

| Task | Effort | Files |
|------|--------|-------|
| Fix `postinstall` script to not break dev mode | 5 min | `package.json` |
| Rename `plexkits.db` â†’ `juggernaut.db` | 5 min | `db.ts`, `.env.example` |
| Remove `plexkits.com` fallback in `WP_BASE_URL` | 5 min | `wp-client.ts` |
| Remove "PLEXKITS Resource Manager" comment | 2 min | `db.ts` |

### Phase B: Profile-Drive the UI (Days 2-3)

| Task | Effort | Files |
|------|--------|-------|
| Make `site-config.ts` read targets from profile | 1 hr | `site-config.ts`, `profiles/index.ts` |
| Make `ResourceTable` use profile for links + columns | 1 hr | `ResourceTable.tsx` |
| Make `CreateModal` read taxonomies from profile | 30 min | `CreateModal.tsx` |
| Make `EditModal` read `siteUrl`/`postTypeSlug` from profile (it already accepts props, just not wired) | 30 min | `page.tsx` |
| Remove hardcoded `TAXONOMY_LABELS` fallback | 15 min | `utils.ts` |

### Phase C: Plugin-Driven EditModal (Days 4-7)

This is the **biggest and most important task**. The 1,965-line EditModal needs to become:

1. **Generic EditModal shell** (~300 lines): Tab bar, save/close buttons, basic layout
2. **Core tabs** (~200 lines each):
   - `BasicTab.tsx` â€” title, slug, status, featured image
   - `ClassificationTab.tsx` â€” taxonomies from profile (generic)
   - `AIFillTab.tsx` â€” prompt templates + profile taxonomy slugs
3. **MetaBox plugin tabs** (moved from EditModal into `plugins/bundled/metabox/components/`):
   - `ContentTab.tsx` â€” intro_text, text_content fields
   - `FeaturesTab.tsx` â€” group_features repeater
   - `DownloadsTab.tsx` â€” download_sections group
   - `ChangelogTab.tsx` â€” group_changelog
4. **SEOPress plugin tab** (moved into `plugins/bundled/seopress/components/`):
   - `SEOTab.tsx` â€” SEO title, description, social, robots

The EditModal shell calls `plugin.getTabs()` on all enabled plugins and renders their components in order.

### Phase D: Profile Import/Export (Day 8)

| Task | Effort | Files |
|------|--------|-------|
| Implement `loadProfileFromFile()` | 2 hr | `profiles/index.ts` |
| Add "Import Profile" button to Settings | 1 hr | `settings/page.tsx` |
| Add "Export Profile" button | 1 hr | `settings/page.tsx` |
| Auto-enable `required_plugins` on import | 1 hr | `profiles/index.ts`, `plugins/registry.ts` |
| Create `starter.json` profile (basic WordPress) | 30 min | `profiles/starter.json` |

### Phase E: First-Launch Flow (Day 9)

| Task | Effort | Files |
|------|--------|-------|
| Detect empty state (no profile, no credentials) | 1 hr | `page.tsx` |
| Create setup wizard component | 3 hr | `components/SetupWizard.tsx` |
| Wire: enter URL â†’ discover plugins â†’ suggest profile â†’ save credentials | 2 hr | Discovery + wizard |

### Phase F: SEO Architecture Fix (Day 10)

| Task | Effort | Files |
|------|--------|-------|
| Add SEO columns to resources table in DB | 1 hr | `db.ts` |
| Store SEO data locally during sync | 2 hr | `seopress/index.ts`, `sync.ts` |
| Push SEO data alongside resource data | 2 hr | `seopress/index.ts`, `push.ts` |
| Use dirty flags for SEO changes | 1 hr | `queries.ts` |

### Phase G: Testing & Polish (Days 11-12)

| Task | Effort |
|------|--------|
| End-to-end test: fresh install â†’ credentials â†’ sync â†’ edit â†’ push | 2 hr |
| Test profile import/export roundtrip | 1 hr |
| Test plugin enable/disable cycle | 1 hr |
| Test site switching | 1 hr |
| Fix any remaining PLEXKITS references | 1 hr |
| Update AGENTS.md and README | 1 hr |

---

## 9. File Structure (Target)

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ resources/          # CRUD
â”‚   â”‚   â”œâ”€â”€ sync/               # Sync engine
â”‚   â”‚   â”œâ”€â”€ push/               # Push engine
â”‚   â”‚   â”œâ”€â”€ terms/              # Taxonomy terms
â”‚   â”‚   â”œâ”€â”€ profile/            # Profile API
â”‚   â”‚   â”œâ”€â”€ plugins/            # Plugin management
â”‚   â”‚   â”œâ”€â”€ site-config/        # Site target switching
â”‚   â”‚   â”œâ”€â”€ prompt-templates/   # AI template CRUD
â”‚   â”‚   â”œâ”€â”€ seo/                # SEO data
â”‚   â”‚   â”œâ”€â”€ discover/           # WP site discovery
â”‚   â”‚   â”œâ”€â”€ test-connection/    # Diagnostics
â”‚   â”‚   â”œâ”€â”€ stats/              # Dashboard stats
â”‚   â”‚   â”œâ”€â”€ upload/             # File uploads
â”‚   â”‚   â””â”€â”€ field-audit/        # Field audit
â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â””â”€â”€ page.tsx            # Settings (refactored into sub-components)
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx                # Main dashboard
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ core/                   # Generic, profile-driven
â”‚   â”‚   â”œâ”€â”€ EditModal.tsx       # Generic shell (~300 lines)
â”‚   â”‚   â”œâ”€â”€ BasicTab.tsx        # Title, slug, status, featured image
â”‚   â”‚   â”œâ”€â”€ ClassificationTab.tsx  # Taxonomies (generic)
â”‚   â”‚   â”œâ”€â”€ AIFillTab.tsx       # AI generation
â”‚   â”‚   â”œâ”€â”€ ResourceTable.tsx   # Profile-driven table
â”‚   â”‚   â”œâ”€â”€ CreateModal.tsx     # Profile-driven create
â”‚   â”‚   â”œâ”€â”€ FilterPanel.tsx     # Profile-driven filters
â”‚   â”‚   â””â”€â”€ SetupWizard.tsx     # First-launch flow
â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”œâ”€â”€ TargetTab.tsx
â”‚   â”‚   â”œâ”€â”€ PromptsTab.tsx
â”‚   â”‚   â”œâ”€â”€ PluginsTab.tsx
â”‚   â”‚   â””â”€â”€ DiagnosticsTab.tsx
â”‚   â””â”€â”€ UpdateNotifier.tsx
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ db.ts                   # SQLite layer
â”‚   â”œâ”€â”€ wp-client.ts            # WP REST client (generic)
â”‚   â”œâ”€â”€ sync.ts                 # Sync engine (generic)
â”‚   â”œâ”€â”€ push.ts                 # Push engine (generic)
â”‚   â”œâ”€â”€ queries.ts              # DB queries
â”‚   â”œâ”€â”€ site-config.ts          # Profile-driven site targets
â”‚   â”œâ”€â”€ utils.ts                # Utilities (no hardcoded labels)
â”‚   â”œâ”€â”€ discovery.ts            # WP site scanning
â”‚   â”œâ”€â”€ field-audit.ts          # Field integrity
â”‚   â”œâ”€â”€ imageProcessing.ts      # Image pipeline
â”‚   â”œâ”€â”€ prompt-templates.ts     # AI templates
â”‚   â”œâ”€â”€ plugins/
â”‚   â”‚   â”œâ”€â”€ types.ts            # All plugin/profile interfaces
â”‚   â”‚   â”œâ”€â”€ hooks.ts            # Hook system
â”‚   â”‚   â”œâ”€â”€ registry.ts         # Plugin registry
â”‚   â”‚   â”œâ”€â”€ loader.ts           # Plugin loader
â”‚   â”‚   â”œâ”€â”€ init.ts             # Plugin initialization
â”‚   â”‚   â”œâ”€â”€ index.ts            # Public API
â”‚   â”‚   â””â”€â”€ bundled/
â”‚   â”‚       â”œâ”€â”€ index.ts
â”‚   â”‚       â”œâ”€â”€ metabox/
â”‚   â”‚       â”‚   â”œâ”€â”€ manifest.json
â”‚   â”‚       â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚       â”‚   â””â”€â”€ components/     # â† NEW
â”‚   â”‚       â”‚       â”œâ”€â”€ ContentTab.tsx
â”‚   â”‚       â”‚       â”œâ”€â”€ FeaturesTab.tsx
â”‚   â”‚       â”‚       â”œâ”€â”€ DownloadsTab.tsx
â”‚   â”‚       â”‚       â””â”€â”€ ChangelogTab.tsx
â”‚   â”‚       â””â”€â”€ seopress/
â”‚   â”‚           â”œâ”€â”€ manifest.json
â”‚   â”‚           â”œâ”€â”€ index.ts
â”‚   â”‚           â””â”€â”€ components/     # â† NEW
â”‚   â”‚               â””â”€â”€ SEOTab.tsx
â”‚   â””â”€â”€ profiles/
â”‚       â”œâ”€â”€ index.ts            # ProfileManager
â”‚       â”œâ”€â”€ plexkits.json       # Bundled profile
â”‚       â””â”€â”€ starter.json        # â† NEW: basic WordPress profile
â”‚
â”œâ”€â”€ electron/
â”‚   â”œâ”€â”€ main.ts                 # Electron main process
â”‚   â”œâ”€â”€ preload.ts              # Context bridge
â”‚   â”œâ”€â”€ server.ts               # Production Next.js server
â”‚   â””â”€â”€ tsconfig.json
â”‚
â””â”€â”€ types/
    â””â”€â”€ global.d.ts
```

---

## 10. Non-Functional Requirements

### Performance
- Sync should handle 500+ resources without UI freeze (paginated, background)
- Table rendering should stay smooth with 500+ rows (virtualization if needed)
- Database operations use prepared statements and transactions for bulk ops

### Security
- Credentials never stored in plain text in production (macOS Keychain)
- No hardcoded secrets in source code
- `contextIsolation: true` in Electron

### Modularity
- No WordPress-plugin-specific code in core components
- All plugin-specific rendering via `getTabs()` / `getFieldRenderers()`
- All site-specific config via profiles
- Adding support for a new WordPress plugin = creating a new plugin directory, no core changes

### Compatibility
- macOS primary (Intel + Apple Silicon)
- Windows/Linux builds possible but not primary targets
- WordPress 5.9+ (REST API v2)
- Node.js 20+ for development (v25 has ABI issues with Electron)

---

## 11. Success Criteria for v1.0

- [ ] `npm run dev` works without errors (native module fix)
- [ ] Fresh install â†’ setup wizard â†’ credentials â†’ first sync works
- [ ] EditModal renders tabs from plugins, not hardcoded
- [ ] No `plexkits` references in core code (only in bundled `plexkits.json` profile)
- [ ] Profile import/export works
- [ ] Sync â†’ edit â†’ push roundtrip works for at least one WordPress site
- [ ] Auto-updates work via GitHub Releases
- [ ] Adding a new WordPress plugin (e.g., ACF) requires only creating files in `plugins/bundled/acf/`, zero core changes

---

## 12. Open Questions

1. **Node.js version**: System is v25.6.0 but Electron 31 bundles Node 20.x. Should we pin dev to Node 20 via `.nvmrc`?
2. ~~**SEO data storage**: Store in `resource_meta` table or add dedicated `seo_data` table?~~ â†’ **Resolved**: SEO stored in `plugin_data` table as JSON blob per post, keyed by plugin ID.
3. **Profile creation UI**: Build a visual profile editor, or just support JSON import?
4. **Testing**: Should we add E2E tests (Playwright) for the Electron app, or focus on unit tests for now?
5. ~~**Database location**: Keep in project dir (`./data/`) or move to `~/Library/Application Support/Juggernaut/`?~~ â†’ **Resolved**: See ADR-006 (workspace-per-database proposal).

---

## 13. Roadmap Progress

> Verified against codebase as of v0.9.9 (2026-02-09).

### Phase 1: Plugin System Foundation (0.9.x) â€” âœ… DONE

- [x] Plugin interface (`types.ts`), hook system (`hooks.ts`), manifest format, plugin loader (`loader.ts`)

### Phase 2: Extract Existing Plugins (1.0.0-alpha) â€” âœ… DONE

- [x] MetaBox plugin extracted â†’ `plugins/bundled/metabox/`
- [x] SEOPress plugin extracted â†’ `plugins/bundled/seopress/`
- [x] PLEXKITS config moved to profile â†’ `profiles/plexkits.json`

### Phase 3: Profile System (1.0.0-beta) â€” ğŸŸ¡ PARTIAL

- [ ] Profile import/export (`loadProfileFromFile()` not implemented)
- [ ] Auto-enable plugins from profile (`required_plugins` field exists but no wiring)
- [x] Site switcher in UI â†’ Settings â†’ Target Site tab
- [x] Profile provides `siteUrl`, `postType`, `taxonomyLabels` to frontend

### Phase 4: Generic Core (1.0.0-rc) â€” âœ… MOSTLY DONE

- [x] Database abstraction â†’ Tables renamed (`resources`â†’`posts`), schema v2 migration
- [x] Any custom post type â†’ `getPrimaryPostType()` reads from profile
- [x] Dynamic taxonomy support â†’ `getTaxonomies()` with `meta_field` and `editable`
- [x] Profile-driven URLs â†’ Components use `siteUrl` and `postTypeSlug` props
- [x] SEO plugin migration â†’ SEOPress uses `plugin_data` table
- [x] Field discovery â†’ `discovery-fields.ts` for auto-detecting custom fields
- [x] Real-time sync progress via SSE streaming with phase tracking (taxonomies, fetching, media, SEO)
- [x] Post type conversion: creates as draft, marks dirty, copies featured image, trashes old post
- [x] Featured image push resolves media URLs to attachment IDs (handles resized URL variants)
- [x] Schema-based core field filtering per CPT via WordPress OPTIONS endpoint
- [x] Field mapping labels prefer human-written profile labels over auto-generated
- [ ] Generic field rendering (EditModal still has hardcoded PLEXKITS MetaBox field layout)

### Phase 5: Electron Packaging (1.0.0) â€” ğŸŸ¡ PARTIAL

- [x] Electron wrapper, macOS Keychain, auto-updates, window dragging
- [ ] Code signing (optional, $99/year)
- [ ] First-launch setup wizard
- [ ] Fix `better-sqlite3` native module ABI conflict (see Â§7.2)

### Phase 6: Plugin Ecosystem (1.1.0+) â€” âŒ NOT STARTED

- [ ] Plugin browser UI, registry API, community submissions, premium marketplace

---

## 14. Remaining PLEXKITS Hardcoding

> Audit of files still containing PLEXKITS-specific references.

### Hardcoded Site URLs

| File | What | Status |
|------|------|--------|
| `src/lib/site-config.ts` | `SITE_TARGETS` array | âš ï¸ Remains (fallback for Settings UI) |
| `src/lib/wp-client.ts` | Legacy `WP_BASE_URL` fallback | âš ï¸ Remains (fallback) |
| `src/components/EditModal.tsx` | Link to resource URL | âœ… Fixed â€” uses `siteUrl` + `postTypeSlug` props |
| `src/components/ResourceTable.tsx` | Link to resource URL | âœ… Fixed â€” uses `siteUrl` + `postTypeSlug` props |

### Hardcoded Taxonomy Slugs

| File | What | Status |
|------|------|--------|
| `src/components/EditModal.tsx` | AI fill patterns | âš ï¸ Remains (could use profile taxonomies) |
| `src/components/CreateModal.tsx` | `EDITABLE_TAXONOMIES` array | âœ… Fixed â€” uses `editableTaxonomies` prop |
| `src/components/ResourceTable.tsx` | Column renders `resource-type` directly | âš ï¸ Remains (columns not configurable) |
| `src/lib/utils.ts` | `TAXONOMY_LABELS` fallback map | âœ… OK â€” fallback only, profile labels used when available |
| `src/lib/plugins/bundled/metabox/index.ts` | `TAXONOMY_META_FIELD` mapping | âœ… Fixed â€” reads from profile with fallback |

### Hardcoded MetaBox Field Layout

| File | What | Status |
|------|------|--------|
| `src/components/EditModal.tsx` | Tabs and fields for PLEXKITS MetaBox fields | âš ï¸ Remains (needs generic field renderer) |
| `src/components/ResourceTable.tsx` | `download_sections` count column | âš ï¸ Remains |

---

## 15. Blockers for v1.0

- [ ] Fix `better-sqlite3` ABI mismatch (`npm rebuild better-sqlite3` after install)
- [ ] Implement profile import/export
- [ ] First-launch setup wizard (or redirect to Settings on empty state)
- [ ] End-to-end test: fresh install â†’ credentials â†’ sync â†’ edit â†’ push

### Nice-to-Have for v1.0

- [ ] Code signing ($99/year Apple Developer)
- [ ] Per-site credential storage
- [ ] Environment badges (prod/staging/local visual distinction)
- [ ] Generic MetaBox field renderer (plugin-driven instead of hardcoded)
- [ ] Configurable table columns from profile

---

## 16. Backlog (Post v1.0)

### Credentials Per Site/Group

Currently credentials are global. Should be per-site or per-site-group (e.g., staging+prod share same credentials, different sites have different ones).

### Profile System Enhancements

- Profiles should be importable (not just bundled)
- Support adding entirely different sites, not just staging/prod variants
- Site targets should come from profile `sites` array, not hardcoded `SITE_TARGETS` const

### Site Switching UX

- Environment flags (prod/staging/local) for visual distinction
- Color coding or badges for active environment
- Warning when switching to production

### Testing

- Integration tests for sync/push cycle
- E2E tests for Electron credential flow
- Test profile switching with different WordPress sites

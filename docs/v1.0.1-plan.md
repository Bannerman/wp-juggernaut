# Juggernaut v1.0 Plan

> **Updated: 2026-02-06**
> Replaces `v1.0-plan.md` with verified roadmap status and expanded technical detail.

## Overview

**Juggernaut** is a modular Mac desktop application for managing WordPress content. It started as "PLEXKITS API Pusher" (a Next.js web app) and is being transformed into a generic, distributable Electron app with a plugin system.

### Core Value Proposition

- Sync WordPress posts/resources to local SQLite for offline editing
- Bulk edit content with a powerful table interface
- Push changes back to WordPress with conflict detection
- AI-powered content generation via prompt templates
- Plugin system to support different WordPress plugins (MetaBox, ACF, SEOPress, Yoast, etc.)

---

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       JUGGERNAUT                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PLUGINS (extend WordPress plugin support)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ MetaBox  â”‚ â”‚ SEOPress â”‚ â”‚   ACF    â”‚ â”‚  Yoast   â”‚      â”‚
â”‚  â”‚ Plugin   â”‚ â”‚ Plugin   â”‚ â”‚ Plugin   â”‚ â”‚ Plugin   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  CORE (generic WordPress management)                       â”‚
â”‚  â€¢ Posts, Pages, Custom Post Types                         â”‚
â”‚  â€¢ Taxonomies (categories, tags, custom)                   â”‚
â”‚  â€¢ Basic fields (title, content, excerpt, featured image)  â”‚
â”‚  â€¢ Sync/Push engine, SQLite caching                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SITE PROFILES (configuration)                             â”‚
â”‚  â€¢ Site URLs, Post types, Enabled plugins                  â”‚
â”‚  â€¢ Field mappings, UI customizations                       â”‚
â”‚  â€¢ Import/Export for sharing                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Plugin Ecosystem (Tiered)

| Tier | Badge | Description | Distribution |
|------|-------|-------------|--------------|
| **BUNDLED** | ğŸŸ¢ | Ships with app, core WP support | Always included |
| **OFFICIAL** | ğŸ”µ | Free, we maintain (MetaBox, SEOPress, ACF, Yoast, WooCommerce) | Bundled, disabled by default |
| **COMMUNITY** | ğŸŸ¡ | Free, PR-submitted, we review | Plugin browser |
| **PREMIUM** | ğŸŸ£ | Paid, 20% revenue share | Marketplace (future) |

### Plugin Size Estimates

| Plugin | Estimated Size |
|--------|----------------|
| MetaBox | ~80-120 KB |
| SEOPress | ~40-60 KB |
| ACF | ~80-120 KB |
| Yoast | ~40-60 KB |
| WooCommerce | ~150-200 KB |
| **Total (all official)** | **~400-600 KB** |

For comparison: Electron runtime is ~150 MB. Plugins are negligible (<1% of app size).

**Decision**: Bundle all official plugins, disabled by default. Enable via Settings or auto-enable via profile import.

---

## Security

### Credential Storage

| Storage Option | Risk Level | Notes |
|----------------|------------|-------|
| `.env` file in app bundle | âš ï¸ Medium | Anyone with Mac access can read |
| **macOS Keychain** | âœ… Low | Encrypted, requires user password |
| Hardcoded in app | ğŸ”´ High | Never do this |

**Decision**: Use Electron's `safeStorage` API (uses macOS Keychain under the hood).

### Credential Flow (Current Implementation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ELECTRON MODE (Production)                                  â”‚
â”‚                                                             â”‚
â”‚  Settings UI                                                â”‚
â”‚    â””â”€â–º window.electronAPI.setCredentials()                  â”‚
â”‚          â””â”€â–º IPC â†’ main process                             â”‚
â”‚                â””â”€â–º safeStorage.encryptString() â†’ Keychain   â”‚
â”‚                â””â”€â–º Injects into process.env                 â”‚
â”‚                â””â”€â–º Restarts Next.js server                  â”‚
â”‚                                                             â”‚
â”‚  Next.js Server (utilityProcess)                            â”‚
â”‚    â””â”€â–º wp-client.ts â†’ getWpCredentials()                    â”‚
â”‚          â””â”€â–º site-config.json credentials (if set)          â”‚
â”‚          â””â”€â–º process.env fallback (from Keychain injection) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DEV MODE (Browser)                                          â”‚
â”‚                                                             â”‚
â”‚  Settings UI                                                â”‚
â”‚    â””â”€â–º fetch('/api/site-config', { credentials })           â”‚
â”‚          â””â”€â–º Saved to site-config.json (less secure)        â”‚
â”‚                                                             â”‚
â”‚  Next.js Server                                             â”‚
â”‚    â””â”€â–º wp-client.ts â†’ getWpCredentials()                    â”‚
â”‚          â””â”€â–º site-config.json credentials                   â”‚
â”‚          â””â”€â–º .env.local fallback                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### First-Launch Flow

1. User opens Juggernaut for the first time
2. Prompted to enter WordPress URL, username, and app password
3. Credentials encrypted and stored in Keychain
4. Never stored in plain text

> **Status**: No first-launch wizard exists yet. Users currently go to Settings â†’ Target Site to enter credentials manually.

### Code Signing

- Without Apple Developer certificate ($99/year): Users see "unidentified developer" warning
- Can bypass with right-click â†’ Open
- For personal/family use, this is acceptable

---

## Distribution

### Electron Desktop App

- **Bundled with**: Node.js, Chromium, Next.js standalone build
- **App size**: ~150-200 MB
- **Platforms**: macOS (primary), Windows/Linux (future)

### Auto-Updates via GitHub Releases

```
1. You build the app â†’ Creates "Juggernaut-1.0.0.dmg"
2. Upload to GitHub Release â†’ Tagged as v1.0.0
3. Wife opens app â†’ App checks GitHub API for newer version
4. You release v1.1.0 â†’ Her app detects, downloads, installs automatically
```

**Wife doesn't need GitHub account** - the app handles everything.

### Repository Strategy

**Decision**: Public repo

- Code isn't sensitive (credentials in Keychain, not repo)
- Simplest auto-update path
- Open-source personal tools is common

---

## Site Profiles

JSON configuration files that define a WordPress site setup:

```json
{
  "version": "1.0",
  "profile_name": "PLEXKITS Resources",
  "sites": [
    { "id": "local", "name": "Local Dev", "url": "http://plexkits-v4.local" },
    { "id": "staging", "name": "Staging", "url": "https://staging.plexkits.com" },
    { "id": "production", "name": "Production", "url": "https://plexkits.com" }
  ],
  "post_types": [
    {
      "slug": "resource",
      "name": "Resource",
      "rest_base": "resource",
      "supports": ["title", "editor", "thumbnail"]
    }
  ],
  "taxonomies": [
    { "slug": "resource-type", "name": "Resource Type", "rest_base": "resource-type" },
    { "slug": "topic", "name": "Topic", "rest_base": "topic" }
  ],
  "required_plugins": ["metabox", "seopress"],
  "ui": {
    "tabs": ["basic", "seo", "content", "features", "classification", "downloads", "ai"],
    "branding": {
      "name": "PLEXKITS Manager",
      "color": "#your-brand-color"
    }
  }
}
```

### Your Wife's Experience

1. Opens Juggernaut
2. Clicks "Import Profile"
3. Selects `plexkits.json` you sent her
4. App auto-enables required plugins (MetaBox, SEOPress)
5. Enters WordPress credentials (stored in Keychain)
6. Everything configured - ready to use

> **Status**: Profile import is **not yet implemented**. `ProfileManager.loadProfileFromFile()` throws "not yet implemented". Only the bundled `plexkits.json` profile works via hardcoded import.

---

## Implementation Roadmap

### Phase 1: Plugin System Foundation (0.9.x) â€” âœ… DONE

- [x] Define plugin interface (TypeScript) â†’ `src/lib/plugins/types.ts`
- [x] Create hook system for extending UI/API â†’ `src/lib/plugins/hooks.ts`
- [x] Plugin manifest format (plugin.json) â†’ `manifest.json` in each bundled plugin
- [x] Plugin loader in app startup â†’ `src/lib/plugins/loader.ts`

### Phase 2: Extract Existing Plugins (1.0.0-alpha) â€” âœ… DONE

- [x] Extract MetaBox support into plugin â†’ `src/lib/plugins/bundled/metabox/`
- [x] Extract SEOPress support into plugin â†’ `src/lib/plugins/bundled/seopress/`
- [x] Move hardcoded PLEXKITS config to profile â†’ `src/lib/profiles/plexkits.json`

> **Note**: The profile exists, but significant PLEXKITS-specific code remains scattered across the codebase (see [Remaining PLEXKITS Hardcoding](#remaining-plexkits-hardcoding) below).

### Phase 3: Profile System (1.0.0-beta) â€” ğŸŸ¡ PARTIAL

- [ ] Profile import/export (`loadProfileFromFile()` not implemented)
- [ ] Auto-enable plugins from profile (`required_plugins` field exists but no wiring)
- [x] Site switcher in UI â†’ Settings â†’ Target Site tab

### Phase 4: Generic Core (1.0.0-rc) â€” ğŸŸ¡ PARTIAL

- [ ] Remove all PLEXKITS hardcoding (see audit below)
- [x] Support any custom post type â†’ `getPrimaryPostTypeRestBase()` reads from profile
- [x] Dynamic taxonomy support â†’ `getTaxonomies()` reads from profile
- [ ] Generic field rendering (EditModal still has PLEXKITS MetaBox field layout)

### Phase 5: Electron Packaging (1.0.0) â€” ğŸŸ¡ PARTIAL

- [x] Electron wrapper around Next.js
- [x] macOS Keychain credential storage (`safeStorage`)
- [x] Auto-updates via GitHub Releases (`electron-updater`)
- [x] Window dragging (`hiddenInset` title bar)
- [ ] Code signing (optional, $99/year)
- [ ] First-launch setup wizard
- [ ] Fix `better-sqlite3` native module ABI conflict (see [Known Issues](#known-issues))

### Phase 6: Plugin Ecosystem (1.1.0+) â€” âŒ NOT STARTED

- [ ] Plugin browser UI
- [ ] Plugin registry API
- [ ] Community plugin submissions
- [ ] Premium plugin marketplace

---

## Remaining PLEXKITS Hardcoding

A full audit of files that still contain PLEXKITS-specific references:

### Hardcoded Site URLs

| File | What | Line(s) |
|------|------|---------|
| `src/lib/site-config.ts` | `SITE_TARGETS` array has `plexkits-v4.local`, `staging.plexkits.com`, `plexkits.com` hardcoded | 14-33 |
| `src/lib/wp-client.ts` | Legacy `WP_BASE_URL` fallback to `https://plexkits.com` | 32 |
| `src/components/EditModal.tsx` | Link to `https://plexkits.com/resource/{slug}/` | 1075-1080 |
| `src/components/EditModal.tsx` | Placeholder `https://plexkits.com/wp-content/uploads/...` | 1152 |
| `src/components/ResourceTable.tsx` | Link to `https://plexkits.com/resource/{slug}` | 325 |

### Hardcoded Taxonomy Slugs

| File | What |
|------|------|
| `src/components/EditModal.tsx` | AI fill patterns hardcoded: `resource-type`, `intent`, `topic`, `audience` | 
| `src/components/CreateModal.tsx` | `EDITABLE_TAXONOMIES` array: `resource-type`, `topic`, `intent`, `audience` |
| `src/components/ResourceTable.tsx` | Column renders `resource-type` directly |
| `src/lib/utils.ts` | `TAXONOMY_LABELS` fallback map with PLEXKITS taxonomy names |
| `src/lib/plugins/bundled/metabox/index.ts` | `TAXONOMY_META_FIELD` mapping (this is appropriate â€” it's the MetaBox plugin) |

### Hardcoded MetaBox Field Layout

| File | What |
|------|------|
| `src/components/EditModal.tsx` | Tabs and fields for `download_sections`, `group_features`, `group_changelog`, `timer_*`, `intro_text`, `text_content`, `featured_image_url` â€” all PLEXKITS-specific MetaBox fields rendered directly |
| `src/components/ResourceTable.tsx` | `download_sections` count column |

### Database

| File | What |
|------|------|
| `src/lib/db.ts` | Default DB path: `./data/plexkits.db` |
| `src/lib/db.ts` | Comment: "Database module for PLEXKITS Resource Manager" |

### What Should Be Generic

To reach v1.0, the following need to be driven by the **profile** and/or **plugin system** instead of hardcoded:

1. **Site targets** â†’ Should come from the active profile's `sites` array, not a const in `site-config.ts`
2. **View Resource links** â†’ Should use `getActiveBaseUrl()` + post type REST base from profile
3. **Taxonomy lists in UI** â†’ `CreateModal` and `ResourceTable` should read from profile, not hardcoded arrays
4. **MetaBox field rendering** â†’ EditModal should use a generic field renderer driven by plugin-provided field definitions, not a giant hardcoded component
5. **AI fill patterns** â†’ Should be configurable per profile or use the taxonomy slugs from the profile
6. **Database path** â†’ Should default to `./data/juggernaut.db` (rename from plexkits)

---

## Known Issues

### ğŸ”´ CRITICAL: `better-sqlite3` Native Module ABI Mismatch

**Symptom**: All API routes that touch the database return 500 errors with `ERR_DLOPEN_FAILED`.

**Root cause**: The `postinstall` script in `package.json` runs `electron-builder install-app-deps`, which recompiles `better-sqlite3` for Electron's Node.js ABI (MODULE_VERSION 125 / Node 20.x). The system Node.js (v25.6.0, MODULE_VERSION 141) can't load this binary, so `npm run dev` is broken.

**Impact**: The Next.js dev server starts but **every database operation fails**. The UI loads but shows "Error: Failed to fetch data" and "No resources found".

**Fix options**:
1. **Quick fix**: Run `npm rebuild better-sqlite3` after install to recompile for system Node. This breaks Electron builds but restores dev mode.
2. **Proper fix**: Remove `postinstall` script. Use a separate `npm run rebuild:electron` script that rebuilds native modules for Electron only before packaging. The `electron:build` scripts should call this.
3. **Alternative**: Use `electron-rebuild` only in the `electron:build:*` scripts, not in `postinstall`.

### âš ï¸ Previous GitHub Releases (v0.9.0 - v0.9.7) Had Packaging Issues

- Various issues with bundling the standalone Next.js build
- Need to test locally before pushing releases
- Use `--prerelease` flag for future test releases

### âš ï¸ SEO Data Architecture

- SEO data is fetched directly from WordPress via SEOPress API
- SEO edits are saved directly to WordPress (not local DB)
- Bypasses the dirty flag / sync system
- If WordPress auth fails, changes are lost (now shows error)
- **TODO**: Store SEO in local DB, sync with rest of resource data

### âš ï¸ No Profile Import/Export

- `ProfileManager.loadProfileFromFile()` throws "not yet implemented"
- Only the bundled `plexkits.json` profile works
- Blocks the "generic tool" vision

---

## Development Setup

### Prerequisites

- Node.js (tested with v20.x; v25.x has native module issues â€” see Known Issues)
- npm

### Running in Dev Mode

```bash
cd src/
npm install
npm run dev              # Starts Next.js on http://localhost:3000
```

> **Important**: If `npm install` ran `electron-builder install-app-deps` (the postinstall hook), you need to run `npm rebuild better-sqlite3` to fix the native module for your system Node.js.

### Running in Electron Dev Mode

```bash
cd src/
npm run build            # Build Next.js standalone
npm run build:electron   # Compile Electron TypeScript
npx electron .           # Launch Electron with built Next.js
```

### Building for Distribution

```bash
cd src/
npm run electron:build:mac   # Build .dmg for macOS
```

### Release Process

1. Update version in `src/package.json`
2. Commit: `git commit -m "Release vX.Y.Z"`
3. Create git tag: `git tag vX.Y.Z`
4. Push tag: `git push origin vX.Y.Z`
5. GitHub Actions builds macOS (Intel + Apple Silicon) and publishes the release

---

## Current Status (v0.9.8)

### Completed

- [x] Electron app structure
- [x] Next.js standalone packaging
- [x] Secure credential storage (macOS Keychain via `safeStorage`)
- [x] Window dragging support (`hiddenInset` title bar)
- [x] Auto-update infrastructure (`electron-updater`)
- [x] Plugin loader with hook system
- [x] MetaBox plugin (bundled, with manifest)
- [x] SEOPress plugin (bundled, with manifest)
- [x] Site target switcher (Settings UI)
- [x] Profile system (basic â€” singleton manager, auto-loads plexkits)
- [x] Settings page with tabs (Target, Prompts, Plugins, Diagnostics)
- [x] Plugin enable/disable toggle in Settings
- [x] AI prompt template editor with version history
- [x] Connection diagnostics

### Blockers for v1.0

- [ ] Fix `better-sqlite3` ABI mismatch (dev mode completely broken)
- [ ] Remove remaining PLEXKITS hardcoding from UI components
- [ ] Implement profile import/export
- [ ] First-launch setup wizard (or at minimum, redirect to Settings on empty state)
- [ ] Test end-to-end: fresh install â†’ enter credentials â†’ sync â†’ edit â†’ push

### Nice-to-Have for v1.0

- [ ] Code signing ($99/year Apple Developer)
- [ ] Per-site credential storage
- [ ] Environment badges (prod/staging/local visual distinction)
- [ ] Generic MetaBox field renderer (plugin-driven instead of hardcoded)

---

## Version History

| Version | Changes |
|---------|---------|
| 0.9.0 | Initial Electron setup |
| 0.9.1 - 0.9.7 | Various packaging fixes (all had issues) |
| 0.9.8 | Secure Keychain credential storage, plugin system, Settings UI |
| 1.0.0 | Target: First stable release |

---

## Future Improvements (Backlog)

### Credentials Per Site/Group

Currently credentials are global. Should be:
- **Per-site** OR **per-site-group** (e.g., staging+prod share same credentials, but different sites have different ones)
- When switching sites within a group, don't need to re-enter credentials
- When switching to a completely different site, prompt for new credentials

### Profile System Enhancements

- Plexkits profile is bundled (done) â€” future profiles should be importable
- Should be able to add completely different sites, not just staging/prod variants
- Site targets should come from profile `sites` array, not hardcoded `SITE_TARGETS` const

### Site Switching UX

- Add **environment flags** (prod/staging/local) for visual distinction
- Color coding or badges to show which environment is active
- Warning when switching to production
- Support for adding entirely different WordPress sites

### Database

- Rename default DB from `plexkits.db` to `juggernaut.db`
- Add migration strategy for schema changes between versions
- Consider backup before destructive operations

### SEO Data Architecture

- Store SEO in local DB, sync with rest of resource data
- Use dirty flag system like other fields
- Push SEO changes alongside resource changes

### Testing

- Add integration tests for sync/push cycle
- Add E2E tests for Electron credential flow
- Test profile switching with different WordPress sites
